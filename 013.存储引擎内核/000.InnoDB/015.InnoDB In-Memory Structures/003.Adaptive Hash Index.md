# Adaptive Hash Index (自适应Hash索引)
## 摘要
1. 什么是自适应Hash索引?
--- 

## 资料
&nbsp;&nbsp;The adaptive hash index enables InnoDB to perform more like an in-memory database on systems with appropriate combinations of workload and sufficient memory for the buffer pool without sacrificing transactional features or reliability. The adaptive hash index is enabled by the innodb_adaptive_hash_index variable, or turned off at server startup by --skip-innodb-adaptive-hash-index.(自适应哈希索引使InnoDB在不牺牲事务特性或可靠性的情况下，在具有适当的工作负载组合和缓冲池足够内存的系统上，执行得更像一个内存数据库。自适应哈希索引通过innodb_adaptive_hash_index变量启用，或者在服务器启动时通过——skip-innodb-adaptive-hash-index关闭。)

&nbsp;&nbsp;Based on the observed pattern of searches, a hash index is built using a prefix of the index key. The prefix can be any length, and it may be that only some values in the B-tree appear in the hash index. Hash indexes are built on demand for the pages of the index that are accessed often.(根据观察到的搜索模式，使用索引键的前缀构建散列索引。前缀可以是任何长度，并且可能只有b树中的某些值出现在哈希索引中。散列索引是根据索引中经常被访问的页的需求建立的。)

&nbsp;&nbsp;If a table fits almost entirely in main memory, a hash index speeds up queries by enabling direct lookup of any element, turning the index value into a sort of pointer. InnoDB has a mechanism that monitors index searches. If InnoDB notices that queries could benefit from building a hash index, it does so automatically.(如果一张表几乎完全放在主内存中，散列索引通过直接查找任意元素来加快查询速度，将索引值转换为一种指针。InnoDB有一个监控索引搜索的机制。如果InnoDB注意到可以从构建哈希索引中获益，它会自动这样做。)

&nbsp;&nbsp;With some workloads, the speedup from hash index lookups greatly outweighs the extra work to monitor index lookups and maintain the hash index structure. Access to the adaptive hash index can sometimes become a source of contention under heavy workloads, such as multiple concurrent joins. Queries with LIKE operators and % wildcards also tend not to benefit. For workloads that do not benefit from the adaptive hash index, turning it off reduces unnecessary performance overhead. Because it is difficult to predict in advance whether the adaptive hash index is appropriate for a particular system and workload, consider running benchmarks with it enabled and disabled.(对于某些工作负载，散列索引查找带来的加速比大大超过了监控索引查找和维护散列索引结构的额外工作。对自适应散列索引的访问有时会在重负载下成为争用的来源，例如多个并发连接。使用LIKE操作符和%通配符的查询也没有什么好处。对于不能从自适应散列索引中受益的工作负载，关闭它可以减少不必要的性能开销。因为很难提前预测自适应哈希索引是否适用于特定的系统和工作负载，所以请考虑在运行基准测试时启用或禁用它。)

&nbsp;&nbsp;The adaptive hash index feature is partitioned. Each index is bound to a specific partition, and each partition is protected by a separate latch. Partitioning is controlled by the innodb_adaptive_hash_index_parts variable. The innodb_adaptive_hash_index_parts variable is set to 8 by default. The maximum setting is 512.(对自适应哈希索引特征进行分区;每个索引都绑定到一个特定的分区，每个分区由一个单独的锁存器保护。分区由innodb_adaptive_hash_index_parts变量控制。innodb_adaptive_hash_index_parts变量默认设置为8。最大设置为512。)

&nbsp;&nbsp;You can monitor adaptive hash index use and contention in the SEMAPHORES section of SHOW ENGINE INNODB STATUS output. If there are numerous threads waiting on rw-latches created in btr0sea.c, consider increasing the number of adaptive hash index partitions or disabling the adaptive hash index.(你可以在SHOW ENGINE INNODB STATUS输出的semaphore部分监控自适应哈希索引的使用和竞争。如果有许多线程在btr0sea.c中创建的rw锁存器上等待，请考虑增加自适应哈希索引分区的数量或禁用自适应哈希索引。)

&nbsp;&nbsp; 关于 adaptive hash index ， 可以通过InnoDB架构图来借助理解:
>  <img src="./../pics/innodb-architecture-8-0.png"/>

>> [013.存储引擎内核/000.InnoDB/014.InnoDB Architecture.md](../../../013.存储引擎内核/000.InnoDB/014.InnoDB%20Architecture.md)

>>  **AHI（Adaptive Hash Index,自适应哈希索引）**:InnoDB存储引擎会监控表上各索引页的查询，如果观察到建立哈希索引可以带来速度提升，则建立哈希索引，即自适应哈希索引。AHI是通过缓冲池的B+树页构建而来，因此建立的速度很快，且不需要对整张表构建哈希索引。[003.MySQL事务/006.InnoDB事务日志/002.InnoDB缓冲池.md](../../../003.MySQL事务/006.InnoDB事务日志/002.InnoDB缓冲池.md#附录)




## 参考资料





