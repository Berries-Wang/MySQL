#  Moving or Copying InnoDB Tables
## 摘要

## 文档
&nbsp;&nbsp;This section describes techniques for moving or copying some or all InnoDB tables to a different server or instance. For example, you might move an entire MySQL instance to a larger, faster server; you might clone an entire MySQL instance to a new replica server; you might copy individual<sup>adj.单独的，个别的；个人的；独特的，与众不同的</sup>tables to another instance to develop and test an application, or to a data warehouse server to produce reports.(本节介绍将部分或全部InnoDB表移动或复制到另一个服务器或实例的技术。例如，你可能会将整个MySQL实例移动到一个更大、更快的服务器;你可以将整个MySQL实例克隆到一个新的复制服务器上;您可以将单个表复制到另一个实例以开发和测试应用程序，或者复制到数据仓库服务器以生成报告。)

&nbsp;&nbsp;[**大小写问题**]On Windows, InnoDB always stores database and table names internally<sup>adv.在国内，在组织内部；在体内，在内部；（计算机）内部</sup> in lowercase. To move databases in a binary format from Unix to Windows or from Windows to Unix, create all databases and tables using lowercase names. A convenient way to accomplish this is to add the following line to the [mysqld] section of your my.cnf or my.ini file before creating any databases or tables:(在Windows上，InnoDB总是在内部以小写形式存储数据库名和表名。要将二进制格式的数据库从Unix移动到Windows或从Windows移动到Unix，请使用小写名称创建所有数据库和表。一种方便的方法是在创建任何数据库或表之前，在my.cnf或my.ini文件的[mysqld]部分添加以下行:)
  ```conf
     [mysqld]
     lower_case_table_names=1
  ```

### Techniques for moving or copying InnoDB tables include:
#### Importing Tables
> [000.Importing InnoDB Tables.md](./000.Importing%20InnoDB%20Tables.md)


#### MySQL Enterprise Backup
&nbsp;&nbsp;The MySQL Enterprise Backup product lets you back up a running MySQL database with minimal disruption to operations while producing a consistent snapshot of the database. When MySQL Enterprise Backup is copying tables, reads and writes can continue. In addition, MySQL Enterprise Backup can create compressed backup files, and back up subsets of tables. In conjunction with the MySQL binary log, you can perform point-in-time recovery. MySQL Enterprise Backup is included as part of the MySQL Enterprise subscription.(MySQL企业备份产品允许您备份运行中的MySQL数据库，对操作的干扰最小，同时生成数据库的一致快照。当MySQL企业备份正在复制表时，读取和写入可以继续。此外，MySQL企业备份还可以创建压缩备份文件，备份表的子集。结合MySQL二进制日志，您可以执行时间点恢复。MySQL企业备份是MySQL企业订阅的一部分。)
> [MySQL Enterprise Backup](../../../../019.MySQL运维篇/000.MySQL%20Enterprise%20Backup.md)

#### Copying Data Files (Cold Backup Method) <sup>通过以下内容，可以发现，还是要按照:[013.存储引擎内核/000.InnoDB/016.InnoDB On-Disk Structures/Tables/000.Importing InnoDB Tables.md](./000.Importing%20InnoDB%20Tables.md)来执行</sup>
&nbsp;&nbsp;You can move an InnoDB database simply by copying all the relevant files listed under "Cold Backups" in Section [14.19.1, “InnoDB Backup”](../../../../019.MySQL运维篇/001.InnoDB%20Backup.md).(你可以通过复制“冷备份”下列出的所有相关文件来移动InnoDB数据库。)

&nbsp;&nbsp;[**FLOAT DOUBLE 浮点类型问题**]InnoDB data and log files are binary-compatible on all platforms having the same floating-point number format. If the floating-point formats differ but you have not used FLOAT or DOUBLE data types in your tables, then the procedure is the same: simply copy the relevant files.(InnoDB数据和日志文件在所有具有相同浮点数格式的平台上都是二进制兼容的。如果浮点格式不同，但您没有在表中使用FLOAT或DOUBLE数据类型，那么过程是相同的:只需复制相关文件。)

&nbsp;&nbsp;When you move or copy file-per-table .ibd files, the database directory name must be the same on the source and destination systems. The table definition stored in the InnoDB shared tablespace includes the database name. The transaction IDs and log sequence numbers stored in the tablespace files also differ between databases.(当移动或复制每表一个文件的.ibd文件时，源系统和目标系统上的数据库目录名必须相同。存储在InnoDB共享表空间中的表定义包括数据库名称。数据库之间存储在表空间文件中的事务id和日志序列号也不同。)

&nbsp;&nbsp;To move an .ibd file and the associated table from one database to another, use a RENAME TABLE statement:(要将.ibd文件和相关表从一个数据库移动到另一个数据库，使用RENAME table语句:)
```sql
      RENAME TABLE db1.tbl_name TO db2.tbl_name;
```

&nbsp;&nbsp;If you have a “clean” backup of an .ibd file, you can restore it to the MySQL installation from which it originated as follows:(如果你有一个.ibd文件的“干净”备份，你可以将它恢复到MySQL安装中，如下所示:)
1. The table must not have been dropped or truncated since you copied the .ibd file, because doing so changes the table ID stored inside the tablespace.(在复制了.ibd文件之后，表不能被删除或截断，因为这样做会改变表空间中存储的表ID。<sub>此时，若执行查询，会导致server崩溃?</sub>)
2. Issue this ALTER TABLE statement to delete the current .ibd file:(执行ALTER TABLE语句删除当前的.ibd文件:)
   ```sql
       ALTER TABLE tbl_name DISCARD TABLESPACE;
   ```
3. Copy the backup .ibd file to the proper database directory.
4. Issue this ALTER TABLE statement to tell InnoDB to use the new .ibd file for the table:
   ```sql
      ALTER TABLE tbl_name IMPORT TABLESPACE;
   ```

&nbsp;&nbsp;In this context, a “clean” .ibd file backup is one for which the following requirements are satisfied:(在这种情况下，“干净的”.ibd文件备份是指满足以下要求的备份:)
- There are no uncommitted modifications by transactions in the .ibd file.(在.ibd文件中没有事务未提交的修改。)
- There are no unmerged insert buffer entries in the .ibd file.(在.ibd文件中没有未合并的插入缓冲区项。)
- Purge has removed all delete-marked index records from the .ibd file.(Purge已经从.ibd文件中删除了所有已删除标记的索引记录。)
- mysqld has flushed all modified pages of the .ibd file from the buffer pool to the file.(Mysqld已将.ibd文件的所有修改页从缓冲池刷新到该文件。)

&nbsp;&nbsp;You can make a clean backup .ibd file using the following method:(使用如下的方法创建干净的.ibd备份文件)
1. Stop all activity from the mysqld server and commit all transactions.
2. Wait until SHOW ENGINE INNODB STATUS shows that there are no active transactions in the database, and the main thread status of InnoDB is Waiting for server activity. Then you can make a copy of the .ibd file.

&nbsp;&nbsp;Another method for making a clean copy of an .ibd file is to use the MySQL Enterprise Backup product:
1. Use MySQL Enterprise Backup to back up the InnoDB installation.
2. Start a second mysqld server on the backup and let it clean up the .ibd files in the backup.

### Restoring from a Logical Backup
&nbsp;&nbsp;You can use a utility such as mysqldump to perform a logical backup, which produces a set of SQL statements that can be executed to reproduce the original database object definitions and table data for transfer to another SQL server. Using this method, it does not matter whether the formats differ or if your tables contain floating-point data.(您可以使用mysqldump等实用程序来执行逻辑备份，这会生成一组SQL语句，可以执行这些语句来重现原始数据库对象定义和表数据，以便传输到另一个SQL服务器。使用此方法，格式是否不同或表是否包含浮点数据都无关紧要。)

&nbsp;&nbsp;To improve the performance of this method, disable autocommit when importing data. Perform a commit only after importing an entire table or segment of a table.(要提高此方法的性能，请在导入数据时禁用自动提交。只有在导入整个表或表段后才执行提交。)


---

## 参考资料
1. [https://dev.mysql.com/doc/refman/8.0/en/innodb-migration.html](https://dev.mysql.com/doc/refman/8.0/en/innodb-migration.html)