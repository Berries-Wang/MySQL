# Creating Tables Externally （外部创建表）
## 摘要
1. 目标是提升MySQL性能

## 文档
&nbsp;&nbsp;There are different reasons for creating InnoDB tables externally; that is, creating tables outside of the data directory. Those reasons might include space management, I/O optimization, or placing tables on a storage device with particular performance or capacity characteristics, for example.(在外部创建InnoDB表有不同的原因;也就是说，在数据目录之外创建表。例如，这些原因可能包括空间管理、I/O优化或将表放置在具有特定性能或容量特征的存储设备上。)

### InnoDB supports the following methods for creating tables externally:

#### Using the DATA DIRECTORY Clause
&nbsp;&nbsp;You can create an InnoDB table in an external<sup>adj.外部的，外面的；对外的，与外国有关的；外来的，外聘的；</sup> directory by specifying a DATA DIRECTORY clause in the CREATE TABLE statement.
```sql
    CREATE TABLE t1 (c1 INT PRIMARY KEY) DATA DIRECTORY = '/external/directory';
```

&nbsp;&nbsp;The DATA DIRECTORY clause is supported for tables created in file-per-table tablespaces. Tables are implicitly created in file-per-table tablespaces when the innodb_file_per_table variable is enabled, which it is by default.(DATA DIRECTORY子句支持在file-per-table表空间中创建的表。当innodb_file_per_table变量被启用时，表将隐式地在每表一个文件的表空间中创建。)
```sql
     mysql> SELECT @@innodb_file_per_table;
     +-------------------------+
     | @@innodb_file_per_table |
     +-------------------------+
     |                       1 |
     +-------------------------+
```

&nbsp;&nbsp;[**指定了就不能修改了**]Be sure of the directory location you choose, as the DATA DIRECTORY clause cannot be used with ALTER TABLE to change the location later.

&nbsp;&nbsp;When you specify a DATA DIRECTORY clause in a CREATE TABLE statement, the table's data file (table_name.ibd) is created in a schema directory under the specified directory, and an .isl file (table_name.isl) that contains the data file path is created in the schema directory under the MySQL data directory. An .isl file is similar in function to a symbolic link. (Actual symbolic links are not supported for use with InnoDB data files.) (当在CREATE TABLE语句中指定DATA DIRECTORY子句时，表的数据文件(table_name.ibd)将在指定目录下的schema目录中创建，而包含数据文件路径的.isl文件(table_name.isl)将在MySQL数据目录下的schema目录中创建。.isl文件在功能上类似于符号链接。(实际的符号链接不支持用于InnoDB数据文件。))

&nbsp;&nbsp;The following example demonstrates creating a table in an external directory using the DATA DIRECTORY clause. It is assumed that the innodb_file_per_table variable is enabled.(下面的示例演示使用DATA directory子句在外部目录中创建表。假设innodb_file_per_table变量是启用的。)
```sql
     mysql> USE test;
     Database changed
     
     mysql> CREATE TABLE t1 (c1 INT PRIMARY KEY) DATA DIRECTORY = '/external/directory';
     
     # MySQL creates the table's data file in a schema directory
     # under the external directory
     
     $> cd /external/directory/test
     $> ls
     t1.ibd
     
     # An .isl file that contains the data file path is created
     # in the schema directory under the MySQL data directory
     
     $> cd /path/to/mysql/data/test
     $> ls
     db.opt  t1.frm  t1.isl
```
##### Usage Notes:
- MySQL initially holds the tablespace data file open, preventing you from dismounting the device, but might eventually close the file if the server is busy. Be careful not to accidentally dismount an external device while MySQL is running, or start MySQL while the device is disconnected. Attempting to access a table when the associated data file is missing causes a serious error that requires a server restart.(MySQL最初保持表空间数据文件打开，防止您卸载设备，但如果服务器很忙，最终可能会关闭该文件。注意不要在MySQL运行时意外卸载外部设备，或者在设备断开连接时启动MySQL。当关联数据文件丢失时，试图访问表将导致严重错误，需要重新启动服务器。)
- A server restart might fail if the data file is not found at the expected path. In this case, manually remove the .isl file from the schema directory. After restarting, drop the table to remove the .frm file and the information about the table from the data dictionary.(如果在预期路径中找不到数据文件，则服务器重启可能会失败。在这种情况下，手动从模式目录中删除.isl文件。重新启动后，删除表以从数据字典中删除.frm文件和关于表的信息。)
- Before placing a table on an NFS-mounted volume, review potential issues outlined in Using NFS with MySQL.(在将表放置在NFS挂载的卷上之前，请查看在使用NFS with MySQL中概述的潜在问题。)
- If using an LVM snapshot, file copy, or other file-based mechanism to back up the table's data file, always use the FLUSH TABLES ... FOR EXPORT statement first to ensure that all changes buffered in memory are flushed to disk before the backup occurs.(如果使用LVM快照、文件副本或其他基于文件的机制来备份表的数据文件，请始终使用FLUSH TABLES…FOR EXPORT语句，以确保在备份发生之前将内存中缓冲的所有更改刷新到磁盘。)
- Using the DATA DIRECTORY clause to create a table in an external directory is an alternative to using symbolic links, which InnoDB does not support.(使用DATA DIRECTORY子句在外部目录中创建表是使用符号链接的另一种选择，符号链接是InnoDB不支持的。)
- The DATA DIRECTORY clause is not supported in a replication environment where the source and replica reside on the same host. The DATA DIRECTORY clause requires a full directory path. Replicating the path in this case would cause the source and replica to create the table in same location.(在源和副本位于同一主机上的复制环境中不支持DATA DIRECTORY子句。DATA DIRECTORY子句需要一个完整的目录路径。在本例中复制路径将导致源和副本在同一位置创建表。)

---
#### Using CREATE TABLE ... TABLESPACE Syntax
&nbsp;&nbsp;CREATE TABLE ... TABLESPACE syntax can be used in combination with the DATA DIRECTORY clause to create a table in an external directory. To do so, specify innodb_file_per_table as the tablespace name. (CREATE TABLE ... TABLESPACE语法可以与DATA DIRECTORY子句结合使用，在外部目录中创建表。为此，请指定innodb_file_per_table作为表空间名称。)
```sql
      mysql> CREATE TABLE t2 (c1 INT PRIMARY KEY) TABLESPACE = innodb_file_per_table DATA DIRECTORY = '/external/directory';
```

&nbsp;&nbsp;This method is supported only for tables created in file-per-table tablespaces, but does not require the innodb_file_per_table variable to be enabled. In all other respects, this method is equivalent to the CREATE TABLE ... DATA DIRECTORY method described above. The same usage notes apply.(此方法仅支持在file-per-table表空间中创建的表，但不需要启用innodb_file_per_table变量。在所有其他方面，这个方法都相当于CREATE TABLE…上述数据目录方法。同样的用法也适用。)

---

#### Creating a Table in an External General Tablespace(在外部通用表空间中创建表)
&nbsp;&nbsp;You can create a table in a general tablespace that resides in an external directory.(您可以在驻留在外部目录中的通用表空间中创建表。)
For information about creating a general tablespace in an external directory, see [Creating a General Tablespace](../TablesSpaces/000.General%20Tablespaces.md).

For information about creating a table in a general tablespace, see [Adding Tables to a General Tablespace](../TablesSpaces/000.General%20Tablespaces.md).







---

## 参考资料
1. [https://dev.mysql.com/doc/refman/8.0/en/innodb-create-table-external.html](https://dev.mysql.com/doc/refman/8.0/en/innodb-create-table-external.html)