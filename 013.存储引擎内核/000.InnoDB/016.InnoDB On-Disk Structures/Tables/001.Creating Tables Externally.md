# Creating Tables Externally (在外部创建表)

&nbsp;&nbsp;There are different reasons for creating InnoDB tables externally; that is, creating tables outside of the data directory. Those reasons might include space management, I/O optimization, or placing tables on a storage device with particular performance or capacity characteristics, for example.(在外部创建InnoDB表有不同的原因。也就是说，在数据目录之外创建表。这些原因可能包括空间管理、I/O优化，或者在具有特定性能或容量特征的存储设备上放置表。)

&nbsp;&nbsp;InnoDB supports the following methods for creating tables externally:

### 方式一: Using the DATA DIRECTORY Clause
&nbsp;&nbsp;You can create an InnoDB table in an external directory by specifying a DATA DIRECTORY clause in the CREATE TABLE statement.(通过在create table语句中指定DATA DIRECTORY子句，可以在外部目录中创建InnoDB表。)
```sql
    CREATE TABLE t1 (c1 INT PRIMARY KEY) DATA DIRECTORY = '/external/directory';
```
&nbsp;&nbsp;The DATA DIRECTORY clause is supported for tables created in [file-per-table tablespaces](../tablespaces/000.File-Per-Table%20Tablespaces.md). Tables are implicitly created in file-per-table tablespaces when the innodb_file_per_table variable is enabled, which it is by default.
```sql
    mysql> SELECT @@innodb_file_per_table;
    +-------------------------+
    | @@innodb_file_per_table |
    +-------------------------+
    |                       1 |
    +-------------------------+
```

&nbsp;&nbsp;When you specify a DATA DIRECTORY clause in a CREATE TABLE statement, the table's data file (table_name.ibd) is created in a schema directory under the specified directory.(当在创建表的语句中指定DATA DIRECTORY子句，则表的数据文件(table_name.ibd)在指定目录的数据库目录下创建)

&nbsp;&nbsp;As of MySQL 8.0.21, tables and table partitions created outside of the data directory using the DATA DIRECTORY clause are restricted to directories known to InnoDB. This requirement permits database administrators to control where tablespace data files are created and ensures that data files can be found during recovery (see [Tablespace Discovery During Crash Recovery](https://dev.mysql.com/doc/refman/8.0/en/innodb-recovery.html#innodb-recovery-tablespace-discovery)). Known directories are those defined by the datadir, innodb_data_home_dir, and innodb_directories variables. You can use the following statement to check those settings:(从MySQL 8.0.21开始，使用data directory子句在数据目录外部创建的表和表分区仅限于InnoDB知道的目录。这个要求允许数据库管理员控制创建表空间数据文件的位置，并确保在恢复期间可以找到数据文件(请参阅崩溃恢复期间的表空间发现)。已知的目录是由datadir、innodb_data_home_dir和innodb_directories变量定义的。可以使用下面的语句检查这些设置:)
```sql
mysql> SELECT @@datadir,@@innodb_data_home_dir,@@innodb_directories;
```

&nbsp;&nbsp;If the directory you want to use is unknown, add it to the innodb_directories setting before you create the table. The [innodb_directories](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_directories) variable is read-only. Configuring it requires restarting the server.

&nbsp;&nbsp;The following example demonstrates creating a table in an external directory using the DATA DIRECTORY clause. It is assumed that the innodb_file_per_table variable is enabled and that the directory is known to InnoDB.
```sql
      mysql> USE test;
      Database changed
      
      mysql> CREATE TABLE t1 (c1 INT PRIMARY KEY) DATA DIRECTORY = '/external/directory';
      
      # MySQL creates the table's data file in a schema directory
      # under the external directory
      
      $> cd /external/directory/test
      $> ls
      t1.ibd
```
##### Usage Notes:(使用注意)
- MySQL initially holds the tablespace data file open, preventing you from dismounting the device, but might eventually close the file if the server is busy. Be careful not to accidentally dismount an external device while MySQL is running, or start MySQL while the device is disconnected. Attempting to access a table when the associated data file is missing causes a serious error that requires a server restart.(MySQL最初保持表空间数据文件打开，以防止您卸载设备，但如果服务器繁忙，可能最终会关闭该文件。注意不要在MySQL运行时意外卸载外部设备，或者在设备断开连接时启动MySQL。当关联的数据文件丢失时，试图访问表会导致严重的错误，需要重新启动服务器。)
    + A server restart might fail if the data file is not found at the expected path. In this case, you can restore the tablespace data file from a backup or drop the table to remove the information about it from the data dictionary.(如果在预期的路径上找不到数据文件，服务器重启可能会失败。在这种情况下，可以从备份中恢复表空间数据文件，或者删除表以从数据字典中删除有关该表的信息。)
- Before placing a table on an NFS-mounted volume, review potential issues outlined in Using NFS with MySQL.(在将表放置到NFS挂载的卷上之前，请检查在MySQL中使用NFS时概述的潜在问题。)
- If using an LVM snapshot, file copy, or other file-based mechanism to back up the table's data file, always use the FLUSH TABLES ... FOR EXPORT statement first to ensure that all changes buffered in memory are flushed to disk before the backup occurs.（如果使用LVM快照、文件副本或其他基于文件的机制来备份表的数据文件，请始终使用FLUSH TABLES ... FOR EXPORT，以确保在备份发生之前，缓冲在内存中的所有更改都被刷新到磁盘。）
- Using the DATA DIRECTORY clause to create a table in an external directory is an alternative to using symbolic links, which InnoDB does not support.（使用DATA DIRECTORY子句在外部目录中创建表是另一种使用符号链接的方式，InnoDB不支持符号链接。）
- The DATA DIRECTORY clause is not supported in a replication environment where the source and replica reside on the same host. The DATA DIRECTORY clause requires a full directory path. Replicating the path in this case would cause the source and replica to create the table in same location.（在源和副本位于同一主机的复制环境中，不支持DATA DIRECTORY子句。DATA DIRECTORY子句需要一个完整的目录路径。在这种情况下，复制路径会导致源和副本在相同的位置创建表。）
- As of MySQL 8.0.21, tables created in file-per-table tablespaces can no longer be created in the undo tablespace directory (innodb_undo_directory) unless that directly is known to InnoDB. Known directories are those defined by the datadir, innodb_data_home_dir, and innodb_directories variables.（从MySQL 8.0.21开始，在每个表的文件表空间中创建的表不能再创建在undo表空间目录(innodb_undo_directory)中，除非InnoDB直接知道这个目录。已知的目录是由datadir、innodb_data_home_dir和innodb_directories变量定义的。） ???

---

### 方式二: Using CREATE TABLE ... TABLESPACE Syntax
&nbsp;&nbsp;CREATE TABLE ... TABLESPACE syntax can be used in combination with the DATA DIRECTORY clause to create a table in an external directory. To do so, specify innodb_file_per_table as the tablespace name.
```sql
mysql> CREATE TABLE t2 (c1 INT PRIMARY KEY) TABLESPACE = innodb_file_per_table
       DATA DIRECTORY = '/external/directory';
```

&nbsp;&nbsp;This method is supported only for tables created in file-per-table tablespaces, but does not require the innodb_file_per_table variable to be enabled. In all other respects, this method is equivalent to the CREATE TABLE ... DATA DIRECTORY method described above. The same usage notes apply.(该方法仅支持在按表文件的表空间中创建的表，但不需要启用innodb_file_per_table变量。在其他方面，这个方法等同于CREATE TABLE…数据目录方法如上所述。同样的用法说明也适用。)

### 方式三: Creating a Table in an External General Tablespace (在外部通用空间中创建表)
&nbsp;&nbsp;You can create a table in a general tablespace that resides in an external directory.(您可以在位于外部目录中的一般表空间中创建表。)
- 创建表空间:For information about creating a general tablespace in an external directory, see [Creating a General Tablespace](https://dev.mysql.com/doc/refman/8.0/en/general-tablespaces.html#general-tablespaces-creating).
- 添加表到通用表空间: For information about creating a table in a general tablespace, see [Adding Tables to a General Tablespace](https://dev.mysql.com/doc/refman/8.0/en/general-tablespaces.html#general-tablespaces-adding-tables).


---

## 参考资料
1. [https://dev.mysql.com/doc/refman/8.0/en/innodb-create-table-external.html](https://dev.mysql.com/doc/refman/8.0/en/innodb-create-table-external.html)