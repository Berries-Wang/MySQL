# InnoDB缓存
## InnoDB内存数据对象
- <img src="./pics/innode-mem-buffer-001.png"/>
  
## 缓存池
&nbsp;&nbsp;InnoDB是基于磁盘存储的，并将其中的记录按照页的方式进行管理。在数据库系统中，因为CPU和磁盘之间的数据差距很大，基于磁盘的数据库系统通常使用缓存池技术来提高数据库的整体性能。
> 通过内存的速度来弥补磁盘速度较慢对于数据库性能的影响.

> 缓冲池的大小直接影响着数据库的整体性能，因此，强烈建议数据库都采用64位的OS

### 数据读操作
&nbsp;&nbsp;缓存池简单来说就是一块内存区域，通过内存的速度来弥补磁盘速度较慢对于数据库性能的影响。在数据库中进行读取页的操作，首先将从磁盘读取到的内存页放在缓存池中(该过程称为 "将页 “FIX” 在缓存池中")，下一次再读取相同的页时，首先判断该页是否在缓存池中。若在缓存池中，则称该页被缓存池命中，直接读取该页；否则，读取磁盘上的页。
> 数据页的读取首先读缓存池，缓存池没有再从磁盘读取并存储到缓存池。

### 数据写操作
&nbsp;&nbsp;对于数据库中的修改，则首先修改在缓存池中的页(**修改（Update 或 Delete改变了页中的记录）之后就成了脏页**)，再以一定的频率刷新到磁盘上。页从缓存池中刷新回磁盘的操作并不是每次页发生更新时触发，而是通过Checkpoint的机制刷新回磁盘。
> 数据修改先修改缓存池，再刷回磁盘



---
## Q&&A
### 001. 数据页刷入磁盘和redo log刷入磁盘的关系
- <img src="./pics/ac5a7c1d1d0e4f76b30ef73342e66b6c.png"/>
- 
  + 如图，更新数据时先将数据写入到Buffer Pool中的数据页中，再写入Redo Log Buffer.


---
## 注意
### buffer pool (缓存池) 与 log buffer（重做日志缓存） 不是同一个概念


## 附录
### 1. [InnoDB 架构](https://dev.mysql.com/doc/refman/8.0/en/innodb-architecture.html)
- <img src="./pics/innodb-architecture.png"/>
- + **AHI（Adaptive Hash Index,自适应哈希索引）**:InnoDB存储引擎会监控表上各索引页的查询，如果观察到建立哈希索引可以带来速度提升，则建立哈希索引，即自适应哈希索引。AHI是通过缓冲池的B+树页构建而来，因此建立的速度很快，且不需要对整张表构建哈希索引。
- + [Change Buffer](https://dev.mysql.com/doc/refman/8.0/en/innodb-change-buffer.html)
- + - Buffer Pool中的一部分，一种特殊的数据结构，主要是对那些不在Buffer Pool中的二级索引数据页进行缓存，减少对磁盘的随机IO。

---
## 参考资料
- [InnoDB Architecture](https://dev.mysql.com/doc/refman/8.0/en/innodb-architecture.html)