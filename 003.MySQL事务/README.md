# InnoDB事务的实现

## MySQL InnoDB架构
- [003.MySQL事务/006.InnoDB事务日志/002.InnoDB缓存池.md](../003.MySQL事务/006.InnoDB事务日志/002.InnoDB缓存池.md)
   + 讲述了InnoDB存储引擎的内存结构<sub>对后续的理解有帮助</sub>

---
## MySQL Binlog及InnoDB事务日志
- [003.MySQL事务/006.InnoDB事务日志](../003.MySQL事务/006.InnoDB事务日志)
    + redo log 
    + undo log 
    + bin log

### 性能与安全
&nbsp;&nbsp;InnoDB使用了一些方式方法来保证MySQL的高并发与安全保障
- Double Write
- BLGC(Binaru Log Group Commit)

---
## MySQL 中的锁
&nbsp;&nbsp;InnoDB中事务的隔离性的支持就是依赖于锁，主要的内容:
+ [000.MySQL之锁](../000.MySQL之锁)
+ - 锁的类别
     1. 自增长锁
     2. Record Lock
     3. Gap Lock
     4. Next-Key Lock
+ - InnoDB是如何加锁的: [000.MySQL之锁/001.加锁方式和时机.md](../000.MySQL之锁/001.加锁方式和时机.md)
+ - MySQL事务隔离级别与锁的关系:[003.MySQL事务/001.InnoDB中的事务隔离级别和锁的关系.md](../003.MySQL事务/001.InnoDB中的事务隔离级别和锁的关系.md)
+ - MySQL undo log 与锁： [MVCC](../003.MySQL事务/002.InnoDB之多版本并发控制-MVCC.md)
     + 一致性锁定读
     + 一致性**非**锁定读
---
## 什么是事务
&nbsp;&nbsp;事务是原子性的SQL语句，或者说是一个独立的工作单元。且事务内的SQL语句，要么全部成功，要么全部失败。<sup>高性能mysql第三版</sup>
## 事务的特性-ACID及其实现
+ 原子性(Atomicity)
   - 原子性指整个事务是不可分割的工作单位。只有事务中所有的数据库操作都执行成功，才算整个事务成功。
     - 原子性是通过 重做日志(Redo Log & Undo Log) 来实现的

+ 一致性(Consistency)
   - 指事务将数据库从一种状态变为下一种一致性的状态。在事务开始之前和事务结束以后，数据库的完整性约束没有被破坏。
      - 一致性是通过 重做日志(Redo Log & Undo Log) 来实现的

+ 隔离性(Isolation)
   - 隔离性还有其他称呼，如并发控制、可串行化、锁等。事务的隔离性要求每个读写事务的对象对其他事务的操作对象相互分离，即该事务提交前对其他事务都不可见，通常这使用锁来实现。                                                            
     - 隔离性是通过锁来实现的。

+ 持久性(Durability)
   - 事务一旦提交，其结果就是永久性的。即使发生宕机等故障，数据库也能将数据恢复。
     - 事务的持久性是通过 重做日志(Redo Log & Undo Log) 来实现的

### 事务完成的标识
&nbsp;&nbsp;InnoDB是事务的存储引擎，其通过Force Log at Commit 机制实现事务的持久性，即当事务提交时，必须先将该事务的所有日志写入到重做日志文件中进行持久化，待事务的commit操作完成才算完成。

---
### 事务专属名词
|名词|解释|
|-|-|
|脏读|什么是脏数据？指未提交的数据。即一个事务读取到了另一个事务未提交的数据，违反了数据的隔离性。|
|幻读（Phantom Problem）|指的是在同一事务下，连续执行两次同样的SQL语句可能导致不同的结果，第二次的SQL语句可能返回之前不存在的行.|
|不可重复读|读到了另一个事务已经提交的数据，但是违反了数据库事务的一致性的要求。|
|可重复读|即解决了不可重复读中违反了事务一致性要求的问题。|

---

## 那么，在开发中应该注意什么？
1. 在更新数据时，仅更新需要更新的字段
2. 不要在循环中提交

---
## 编译一下
- [编译说明](../001.SOURCE_CODE)
