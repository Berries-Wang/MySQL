# 分布式事务
在分布式系统中一次操作需要多个服务协同完成，这种由不同的服务之间通过网络协同完成的事务成为分布式事务。


---

## 分布式事务应当考虑的问题
1. 网络拥堵问题.
   ```txt
    TCC 模式下 (悬挂问题)
      因为网络拥堵，从而导致Cancel 比 Try先到，所以Cancel比Try先执行，所以，在Cancel在返回回滚成功之前，需要记录该条事务日志xid或业务主键，等到Try到来处理Try时，先检查这条事务xid或者业务主键是否标记为回滚成功，若是，则不执行Try的业务操作.
   ```

2. 网络超时 OR 丢包
   ```txt
       TCC模式下（空回滚问题）
          Try超时或丢包，导致TCC分布式事务二阶段的回滚，触发Cancel操作。即 事务参与者未收到Try,但是却接收到了Cancel操作
   ```

---

## 各方案常见使用场景总结
|事务实现方式|适用场景描述|
|-|-|
|2PC/3PC | 依赖于数据库，能够很好地提供强一致性和强事务，但延迟比较高，适合传统的单体应用，在同一个方法中存在跨库操作的情况，不适合高并发和高性能要求的场景|
| TCC| 在准备阶段业务多，锁粒度小，性能要求高，只要把 Try  Confirm  Cancel各阶段的逻辑捋清楚就可以使用TCC，但是存在业务耦合|
|本地消息表/MQ事务| 适用于事务中参与方操作幂等，对一致性要求不高，业务上能容忍不一致到一个人工检查周期，事务涉及的参与方、参与环节少，业务上有对账/校验系统兜底|
| Saga事务| 由于Saga事务不能保证隔离性，需要在业务层控制并发，适合业务场景事务并发操作同一个资源较少的情况(并发能力低)。Saga由于缺少预提交操作，导致补偿动作实现比较麻烦，所以，Saga事务较适用于补偿操作容易处理的场景。|