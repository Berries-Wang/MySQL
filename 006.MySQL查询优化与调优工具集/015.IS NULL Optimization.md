# IS NULL Optimization
> 在查询开始前去掉没有意义的查询条件，避免查询时对行数据无意义的比较。

&nbsp;&nbsp;MySQL can perform the same optimization on col_name IS NULL that it can use for col_name = constant_value. For example, MySQL can use indexes and ranges to search for NULL with IS NULL.(MySQL可以对col_name IS NULL进行与col_name = constant_value相同的优化。例如，MySQL可以使用索引和范围来搜索NULL。)
```sql
# Examples
   SELECT * FROM tbl_name WHERE key_col IS NULL;
   
   SELECT * FROM tbl_name WHERE key_col <=> NULL;
   
   SELECT * FROM tbl_name
     WHERE key_col=const1 OR key_col=const2 OR key_col IS NULL;
```

&nbsp;&nbsp;If a WHERE clause includes a col_name IS NULL condition for a column that is declared as NOT NULL, that expression is optimized away. This optimization does not occur in cases when the column might produce NULL anyway (for example, if it comes from a table on the right side of a LEFT JOIN).(对于声明为NOT NULL的列，如果WHERE子句中包含col_name IS NULL条件，则该表达式会被优化掉。这种优化不会发生在列可能产生NULL的情况下(例如，如果它来自左联结的右侧表)。)

&nbsp;&nbsp;MySQL can also optimize the combination col_name = expr OR col_name IS NULL, a form that is common in resolved subqueries. EXPLAIN shows ref_or_null when this optimization is used.(MySQL还可以优化col_name = expr或col_name IS NULL的组合，这是解析子查询中常见的一种形式。在使用该优化时，EXPLAIN显示ref_or_null。)

&nbsp;&nbsp;This optimization can handle one IS NULL for any key part.(这种优化可以处理任何Key部分为NULL的情况。)

&nbsp;&nbsp;Some examples of queries that are optimized, assuming that there is an index on columns a and b of table t2:（假设在表t2的a列和b列上有一个索引，下面是一些优化的查询示例:）
```sql
   SELECT * FROM t1 WHERE t1.a=expr OR t1.a IS NULL;

   SELECT * FROM t1, t2 WHERE t1.a=t2.a OR t2.a IS NULL;

   SELECT * FROM t1, t2
     WHERE (t1.a=t2.a OR t2.a IS NULL) AND t2.b=t1.b;
   
   SELECT * FROM t1, t2
     WHERE t1.a=t2.a AND (t2.b=t1.b OR t2.b IS NULL);
   
   SELECT * FROM t1, t2
     WHERE (t1.a=t2.a AND t2.a IS NULL AND ...)
     OR (t1.a=t2.a AND t2.a IS NULL AND ...);
```

&nbsp;&nbsp;ref_or_null works by first doing a read on the reference key, and then a separate search for rows with a NULL key value.(ref_or_null首先读取引用的索引，然后单独搜索键值为空的行。)

&nbsp;&nbsp;The optimization can handle only one IS NULL level. In the following query, MySQL uses key lookups only on the expression (t1.a=t2.a AND t2.a IS NULL) and is not able to use the key part on b:(优化只能处理一个IS NULL级别。在下面的查询中，MySQL只对表达式(t1.a=t2.a  和 t2.a IS NULL)进行索引查找，且无法在b上使用索引)
```sql
    SELECT * FROM t1, t2
       WHERE (t1.a=t2.a AND t2.a IS NULL)
       OR (t1.b=t2.b AND t2.b IS NULL);
```

## 参考资料
1. [https://dev.mysql.com/doc/refman/8.2/en/is-null-optimization.html](https://dev.mysql.com/doc/refman/8.2/en/is-null-optimization.html)