# 8.2.1.4 Engine Condition Pushdown Optimization
> 仅支持NDB存储引擎

&nbsp;&nbsp;This optimization improves<sup>改善</sup> the efficiency<sup>效率</sup> of direct comparisons<sup>比较</sup> between a nonindexed column and a constant. In such cases, the condition is “pushed down” to the storage engine for evaluation<sup>评价，评估</sup>. This optimization can be used only by the NDB<sup>专用的基于内存的存储引擎:“NDB” 是一种“内存中”的存储引擎，它具有可用性高和数据一致性好的特点。</sup> storage engine.(这种优化提高了非索引列和常量之间直接比较的效率。在这种情况下，条件被“下推”到存储引擎进行计算。此优化只能由NDB存储引擎使用。)

&nbsp;&nbsp;For NDB Cluster, this optimization can eliminate the need to send nonmatching rows over the network between the cluster's data nodes and the MySQL server that issued the query, and can speed up queries where it is used by a factor of 5 to 10 times over cases where condition pushdown could be but is not used.(对于NDB Cluster，这种优化可以消除在集群的数据节点和发出查询的MySQL服务器之间通过网络发送不匹配行的需要，并且可以将查询速度提高5到10倍，而不是使用条件下推的情况。)

&nbsp;&nbsp;Suppose that an NDB Cluster table is defined as follows:(假设一个NDB Cluster表定义如下:)
```sql
   CREATE TABLE t1 (
    a INT,
    b INT,
    KEY(a)
   ) ENGINE=NDB;
```
&nbsp;&nbsp;Engine condition pushdown can be used with queries such as the one shown here, which includes a comparison between a nonindexed column and a constant:(引擎条件下推可以用于如下所示的查询，其中包括非索引列和常量之间的比较:)
```sql
    SELECT a, b FROM t1 WHERE b = 10;
```

&nbsp;&nbsp;The use of engine condition pushdown can be seen in the output of EXPLAIN:(在EXPLAIN的输出中可以看到'engine condition pushdown'的使用情况:)
```sql
    mysql> EXPLAIN SELECT a,b FROM t1 WHERE b = 10\G
    *************************** 1. row ***************************
               id: 1
      select_type: SIMPLE
            table: t1
             type: ALL
    possible_keys: NULL
              key: NULL
          key_len: NULL
              ref: NULL
             rows: 10
            Extra: Using where with pushed condition
```

&nbsp;&nbsp;However, engine condition pushdown cannot be used with either of these two queries:(然而，在如下两种查询中，‘engine condition pushdown’将不会被使用)
```sql
     SELECT a,b FROM t1 WHERE a = 10;
     SELECT a,b FROM t1 WHERE b + 1 = 10;
```

&nbsp;&nbsp;Engine condition pushdown is not applicable to the first query because an index exists on column a. (An index access method would be more efficient and so would be chosen in preference to condition pushdown.) Engine condition pushdown cannot be employed for the second query because the comparison involving the nonindexed column b is indirect. (However, engine condition pushdown could be applied if you were to reduce b + 1 = 10 to b = 9 in the WHERE clause.)(引擎条件下推不适用于第一个查询，因为索引存在于列a上(索引访问方法会更有效，因此会优先选择条件下推)。引擎条件下推不能用于第二个查询，因为涉及非索引列b的比较是间接的。(但是，如果您要在WHERE子句中将b + 1 = 10减少到b = 9，则可以应用引擎条件下推。))

&nbsp;&nbsp;Engine condition pushdown may also be employed when an indexed column is compared with a constant using a > or < operator:(当使用>或<操作符将索引列与常量进行比较时，也可以使用引擎条件下推:)
```sql
     mysql> EXPLAIN SELECT a, b FROM t1 WHERE a < 2\G
     *************************** 1. row ***************************
                id: 1
       select_type: SIMPLE
             table: t1
              type: range
     possible_keys: a
               key: a
           key_len: 5
               ref: NULL
              rows: 2
             Extra: Using where with pushed condition
```

&nbsp;&nbsp;Other supported comparisons for engine condition pushdown include the following:
- column [NOT] LIKE pattern
- column IS [NOT] NULL
- column IN (value_list)
- column BETWEEN constant1 AND constant2

&nbsp;&nbsp;In all of the cases in the preceding list, it is possible for the condition to be converted into the form of one or more direct comparisons between a column and a constant.(在前面列表中的所有情况下，都可以将条件转换为列和常量之间的一个或多个直接比较的形式。)

&nbsp;&nbsp;Engine condition pushdown is enabled by default. To disable it at server startup, set the optimizer_switch system variable's engine_condition_pushdown flag to off. For example, in a my.cnf file, use these lines:(引擎状态下推默认启用。要在服务器启动时禁用它，请将optimizer_switch系统变量的engine_condition_pushdown标志设置为off。例如，在my.cnf文件中，使用这些行:)
```conf
    [mysqld]
    optimizer_switch=engine_condition_pushdown=off
```

&nbsp;&nbsp;At runtime, disable condition pushdown like this:(运行时禁用)
```sql
    SET optimizer_switch='engine_condition_pushdown=off';
```

&nbsp;&nbsp;Limitations.  Engine condition pushdown is subject to the following limitations:(局限性。'Engine condition pushdown'受以下限制:)
- Engine condition pushdown is supported only by the NDB storage engine.(仅支持NDB存储引擎)
- Columns may be compared with constants only; however, this includes expressions which evaluate to constant values.(但是，这包括求值为常数值的表达式。)
- Columns used in comparisons cannot be of any of the BLOB or TEXT types. This exclusion extends to JSON, BIT, and ENUM columns as well.(比较中使用的列不能是任何BLOB或TEXT类型。这种排除也扩展到JSON、BIT和ENUM列。)
- A string value to be compared with a column must use the same collation as the column.
- Joins are not directly supported; conditions involving<sup>涉及；包括；使陷于（involve 的 ing 形式）</sup> multiple tables are pushed separately where possible. Use extended EXPLAIN output to determine which conditions are actually pushed down.


## 参考资料
1. [8.2.1.4 Engine Condition Pushdown Optimization](https://dev.mysql.com/doc/refman/5.7/en/engine-condition-pushdown-optimization.html)