# MySQL字符串更新-转义字符避坑
## 结论
&nbsp;&nbsp; 可以忽略，虽然无法格式化，但是不影响程序运行。但最好还是验证一下，毕竟线上环境

## 背景
&nbsp;&nbsp;活动有个拓展字段extra_config,存储的是JSON字符串，内含转义字符，客户需求: 修改一些活动配置，然而在更新时，更新后的数据格式化报错，究其原因，是因为转义字符惹的祸。

&nbsp;&nbsp;现场回顾&验证(特殊字符: \n\t):
```sql
     mysql> show create table bug_fix\G
     *************************** 1. row ***************************
            Table: bug_fix
     Create Table: CREATE TABLE `bug_fix` (
       `id` bigint NOT NULL AUTO_INCREMENT,
       `extra_config` text,
       PRIMARY KEY (`id`)
     ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
     1 row in set (0.02 sec)

    mysql> 
    # A a = new A();
    # a.setA("aaaa");
    # a.setB("I am Test Data \n\t Ha Ha Ha \n\t Ha Ha Ha ");
    # jdbcTemplate.update(String.format("INSERT INTO bug_fix(extra_config) VALUES('%s');", JSONObject.toJSONString(a)));
    # 代码插入数据:
    
    mysql> select * from bug_fix;
    +----+------------------------------------------------------------+
    | id | extra_config                                               |
    +----+------------------------------------------------------------+
    |  4 | {"a":"aaaa","b":"I am Test Data 
             Ha Ha Ha 
             Ha Ha Ha "} |
    +----+------------------------------------------------------------+
    1 row in set (0.00 sec)
    
    # 但是这样并不会影响代码执行: 看如下代码和其输出
    # List<String> as = jdbcTemplate.queryForList("select extra_config from  bug_fix", String.class);
    #     for (String a1 : as) {
    #         System.out.println(a1);
    #         A a2 = JSONObject.parseObject(a1, A.class);
    #         System.out.println(a2.toString());
    #     }
    # {"a":"aaaa","b":"I am Test Data 
	#  Ha Ha Ha 
	#  Ha Ha Ha "}
    # CaseInsensitiveSummarizeDataMakeService.A(a=aaaa, b=I am Test Data 
    # 	 Ha Ha Ha 
    # 	 Ha Ha Ha )

    # ------------ 手动插入一条数据,代码查询和console查询
    mysql> INSERT INTO bug_fix(extra_config) VALUES('{"a":"aaaa","b":"I am Test Data \n\t HaHa HaHa HaHa \n\t HaHa HaHa HaHa "}');
    Query OK, 1 row affected (0.01 sec)
    
    mysql> select * from bug_fix;
    +----+------------------------------------------------------------------------+
    | id | extra_config                                                           |
    +----+------------------------------------------------------------------------+
    |  4 | {"a":"aaaa","b":"I am Test Data 
             Ha Ha Ha 
             Ha Ha Ha "}             |
    |  5 | {"a":"aaaa","b":"I am Test Data 
             HaHa HaHa HaHa 
             HaHa HaHa HaHa "} |
    +----+------------------------------------------------------------------------+
    2 rows in set (0.00 sec)
    
    mysql> 
    # 代码输出
    # List<String> as = jdbcTemplate.queryForList("select extra_config from  bug_fix", String.class);
    #     for (String a1 : as) {
    #         System.out.println(a1);
    #         A a2 = JSONObject.parseObject(a1, A.class);
    #         System.out.println(a2.toString());
    #     }
    # {"a":"aaaa","b":"I am Test Data 
	#  Ha Ha Ha 
	#  Ha Ha Ha "}
    # CaseInsensitiveSummarizeDataMakeService.A(a=aaaa, b=I am Test Data 
    # 	 Ha Ha Ha 
    # 	 Ha Ha Ha )
    # {"a":"aaaa","b":"I am Test Data 
    # 	 HaHa HaHa HaHa 
    # 	 HaHa HaHa HaHa "}
    # CaseInsensitiveSummarizeDataMakeService.A(a=aaaa, b=I am Test Data 
    # 	 HaHa HaHa HaHa 
    # 	 HaHa HaHa HaHa )
    
    # 可以发现，console & 代码查询输出的extra_config字段都没有办法格式化(json.cn OR vscode 保存为json格式会报错)，但是不影响代码执行.
```